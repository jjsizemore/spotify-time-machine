# Lefthook configuration
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    # Lint and format TypeScript/JavaScript files
    oxlint:
      glob: '*.{ts,tsx,js,jsx,cjs,mjs}'
      run: pnpm exec oxlint --fix {staged_files}
      stage_fixed: true

    eslint:
      glob: '*.{ts,tsx,js,jsx,cjs,mjs}'
      run: pnpm exec eslint --fix {staged_files}
      stage_fixed: true

    # Format code files
    prettier-code:
      glob: '*.{ts,tsx,js,jsx,cjs,mjs}'
      run: pnpm exec prettier --write {staged_files}
      stage_fixed: true

    # Format config/doc files
    prettier-config:
      glob: '*.{json,md,mdx,css,scss,html,yml,yaml}'
      run: pnpm exec prettier --write {staged_files}
      stage_fixed: true

    # Spell check
    typos:
      glob: '*.{ts,tsx,js,jsx,cjs,mjs,json,md,mdx,yml,yaml}'
      run: typos --write-changes {staged_files}
      stage_fixed: true

    # Security scanning
    semgrep:
      glob: '*.{ts,tsx,js,jsx,cjs,mjs}'
      run: |
        export PATH="${HOME}/.local/share/mise/shims:${PATH}"
        pnpm exec semgrep --config semgrep.yml {staged_files}

    # Shell script linting
    shellcheck:
      glob: '*.sh'
      run: shellcheck {staged_files}

    # Type checking (runs on all files, not just staged)
    type-check:
      run: pnpm exec tsc --noEmit
      glob: '*.{ts,tsx}'

pre-push:
  parallel: true
  commands:
    # Run quality checks in parallel (leverages Turborepo)
    lint:
      run: turbo lint

    format-check:
      run: turbo fmt:check

    type-check:
      run: turbo type-check

    tests:
      run: turbo test

    # Security scanning
    security:
      run: TERM=dumb mise run security

commit-msg:
  commands:
    commitlint:
      run: pnpm exec commitlint --edit {1}
